CREATE DATABASE DA1;


CREATE TABLE KHACHHANG (
    MAKH NVARCHAR(50) PRIMARY KEY,
    TENKH NVARCHAR(50) NOT NULL,
    DIACHI NVARCHAR(50),
    EMAIL NVARCHAR(50),
    SDT NVARCHAR(20),
    NgaySinh DATE
);

delete from KHACHHANG
insert into KHACHHANG values
	('KH1','Nguyễn Văn A','Nam Định','a@gmail.com','0363926648','01-23-2004'),
	('KH2','Nguyễn Văn B','Hà Nội','b@gmail.com','0363926643','12-23-2003'),
	('KH3','Nguyễn Văn C','Huế','c@gmail.com','0363926642','01-03-2004'),
	('KH4','Nguyễn Văn D','Hà Nội','d@gmail.com','0363926641','01-13-1998'),
	('KH5','Nguyễn Văn E','TP HCM','e@gmail.com','0363926646','01-01-2004')



CREATE TABLE NHANVIEN (
    IDNV NVARCHAR(50) PRIMARY KEY,
    TEN NVARCHAR(50) NOT NULL,
    GIOITINH NVARCHAR(50),
    NGAYSINH DATE,
    EMAIL NVARCHAR(50),
    SDT NVARCHAR(50),
    TAIKHOAN NVARCHAR(50)  NULL,
    PASWORD CHAR(65)  NULL,
    ROLES NVARCHAR(20)
);

delete from NHANVIEN
insert into NHANVIEN values
	('NV1','Phạm Quốc Việt','Nam','03-26-2004','viet@gmail.com','0358406612','viet','123','admin'),
	('NV2','Chu Quốc Khánh','Nam','12-22-2004','khanh@gmail.com','0475639263','khanh','123','admin'),
	('NV3','Đặng Hồng Huy','Nam','05-12-2004','huy@gmail.com','0472539572','huy','123','admin'),
	('NV4','Nguyễn Trọng Tín','Nam','03-12-2004','tin@gmail.com','0463847503','tin','123','admin')


CREATE TABLE NHACUNGCAP (
    MANCC NVARCHAR(50) PRIMARY KEY,
    TENNHACUNGCAP NVARCHAR(50) NOT NULL,
    DIACHI NVARCHAR(50),
    EMAIL NVARCHAR(50),
    SDT NVARCHAR(20),
    NGAYNHAP DATE,
    MOTA NVARCHAR(255)
);

delete from NHACUNGCAP
insert into NHACUNGCAP values
	('NCC1','Nhà Cung Cấp A','Hà Nội','ncca@gmail.com','0999999999','12-04-2023','....'),
	('NCC2','Nhà Cung Cấp B','Nam Định','nccb@gmail.com','0888888888','12-04-2023','....'),
	('NCC3','Nhà Cung Cấp C','TP HCM','nccc@gmail.com','0777777777','12-04-2023','....'),
	('NCC4','Nhà Cung Cấp D','Huế','nccd@gmail.com','0066666666','12-04-2023','....'),
	('NCC5','Nhà Cung Cấp E','Hà Nam','ncce@gmail.com','099999999','12-04-2023','....')



CREATE TABLE THELOAI(
    MATL NVARCHAR(50) PRIMARY KEY,
    THELOAI NVARCHAR(50) NOT NULL
);

delete from THELOAI
insert into THELOAI values
	('TL1','Sách Thiếu Nhi'),
	('TL2','Sách Tâm Lý Tình Cảm'),
	('TL3','Sách tôn giáo'),
	('TL4','Sách văn hoá xã hội'),
	('TL5','Sách lịch sử'),
	('TL6','Sách văn học viễn tưởng'),
	('TL7','Sách tiểu sử, tự truyện'),
	('TL8','Sách kinh dị, bí ẩn'),
	('TL9','Sách dạy nấu ăn'),
	('TL10','Sách khoa học công nghệ')

CREATE TABLE TACGIA(
    MATG NVARCHAR(50) PRIMARY KEY,
    TENTG NVARCHAR(50),
    DIACHI NVARCHAR(50),
    SDT NVARCHAR(50)
);

delete from TACGIA
insert into TACGIA values
	('TG1','Trần Văn A','Hà Nội','0384658831'),
	('TG2','Trần Văn B','Hà Nam','0384658833'),
	('TG3','Trần Văn C','Nam Định','0384658835'),
	('TG4','Trần Văn D','Hà Nội','0384658837'),
	('TG5','Trần Văn E','Hà Nội','0384658832')

CREATE TABLE NHAXUATBAN (
    MANXB NVARCHAR(50) PRIMARY KEY,
    TENNXB NVARCHAR(50) NOT NULL,
    DIACHI NVARCHAR(50),
    EMAIL NVARCHAR(50),
    SDT NVARCHAR(20)
);

delete from NHAXUATBAN
insert into NHAXUATBAN values
	('NXB1','Nhà Xuất Bản A','Hà Nội','nxba@gmail.com','0384658832'),
	('NXB2','Nhà Xuất Bản B','Hà Nam','nxbb@gmail.com','0384658831'),
	('NXB3','Nhà Xuất Bản C','Nam Định','nxbc@gmail.com','0384658833'),
	('NXB4','Nhà Xuất Bản D','Hà Nội','nxbd@gmail.com','0384658835'),
	('NXB5','Nhà Xuất Bản E','TP HCM','nxbe@gmail.com','0384658837')

CREATE TABLE SACH(
    MASACH NVARCHAR(50) PRIMARY KEY,
    MANXB NVARCHAR(50),
    THELOAI NVARCHAR(50) NOT NULL,
    MATG NVARCHAR(50),
    TENSACH NVARCHAR(50),
    NAMXUATBAN INT,
    SOLUONG INT,
    GIAMUA INT,
    ANH NVARCHAR(50),
    FOREIGN KEY(THELOAI) REFERENCES THELOAI(MATL),
    FOREIGN KEY(MANXB) REFERENCES NHAXUATBAN(MANXB),
	FOREIGN KEY(MATG) REFERENCES TACGIA(MATG)
);

delete from SACH
insert into SACH values
	('S1','NXB1','TL1','TG1','Những tấm lòng cao cả',2004,50,50000,''),
	('S2','NXB1','TL2','TG2','Thất tịch không mưa',2002,40,70000,''),
	('S3','NXB2','TL3','TG3','Phật giáo',2004,80,90000,''),
	('S4','NXB2','TL4','TG4','Văn hóa nhật bản',1990,20,100000,''),
	('S5','NXB3','TL5','TG5','Lịch sử nước nhà',2023,100,90000,''),
	('S6','NXB3','TL6','TG1','abc',2022,60,50000,''),
	('S7','NXB4','TL7','TG2','xyz',2004,10,50000,''),
	('S8','NXB4','TL8','TG3','Tết ở làng địa ngục',2024,200,100000,''),
	('S9','NXB5','TL9','TG4','......',2004,10,50000,''),
	('S10','NXB5','TL10','TG5','Những tấm lòng cao cả',2004,10,50000,'')
	


CREATE TABLE SACH_NHACUNGCAP (
    MASACH NVARCHAR(50) NOT NULL,
    MANCC NVARCHAR(50) NOT NULL,
    PRIMARY KEY (MASACH, MANCC),
    FOREIGN KEY (MASACH) REFERENCES SACH(MASACH),
    FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)
);

delete from SACH_NHACUNGCAP
insert into SACH_NHACUNGCAP values
	('S1','NCC1'),
	('S2','NCC2'),
	('S3','NCC3'),
	('S4','NCC4'),
	('S5','NCC5'),
	('S6','NCC1'),
	('S7','NCC2'),
	('S8','NCC3'),
	('S9','NCC4'),
	('S10','NCC5')


CREATE TABLE SACH_TACGIA (
    MASACH NVARCHAR(50) NOT NULL,
    MATG NVARCHAR(50) NOT NULL,
    PRIMARY KEY (MASACH, MATG),
    FOREIGN KEY (MASACH) REFERENCES SACH(MASACH),
    FOREIGN KEY (MATG) REFERENCES TACGIA(MATG)
);

delete from SACH_TACGIA
insert into SACH_TACGIA values
	('S1','TG1'),
	('S2','TG2'),
	('S3','TG3'),
	('S4','TG4'),
	('S5','TG5'),
	('S6','TG1'),
	('S7','TG2'),
	('S8','TG3'),
	('S9','TG4'),
	('S10','TG5')

CREATE TABLE KHUYENMAI (
    MAKM NVARCHAR(50) PRIMARY KEY,
    TENKHUYENMAI NVARCHAR(50) NOT NULL,
    NGAYBATDAU DATETIME,
    NGAYKETTHUC DATE,
	GIAMGIA INT,
    TRANGTHAI NVARCHAR(50) NOT NULL, 
);

delete from KHUYENMAI
insert into KHUYENMAI values
	('KM1','abc','04-10-2024','04-29-2024','20000','Hoạt Động')

CREATE TABLE CTKHUYENMAI (
    MAKM NVARCHAR(50) NOT NULL,
    MASACH NVARCHAR(50) NOT NULL,
    FOREIGN KEY(MAkm) REFERENCES KHUYENMAI(MAKM),
    FOREIGN KEY(MASACH) REFERENCES SACH(MASACH),
    PRIMARY KEY (MAkm, MASACH)
);

delete from CTKHUYENMAI
insert into CTKHUYENMAI values
	('KM1','S1'),
	('KM1','S5')
	


CREATE TABLE HOADON (
    MAHD NVARCHAR(50) PRIMARY KEY,
    MAKH NVARCHAR(50) NOT NULL,
    IDNV NVARCHAR(50) NOT NULL,
	MASACH  NVARCHAR(50) NOT NULL,
	SOLUONG int null,
    NGAYLAP DATETIME,
    TONGTIEN INT,
    GIAMGIA INT NOT NULL,
    THANHTIEN INT,
	FOREIGN KEY(MASACH) REFERENCES SACH(MASACH),
    FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH),
    FOREIGN KEY(IDNV) REFERENCES NHANVIEN(IDNV)
);

delete from HOADON
insert into HOADON values
	('HD1','KH1','NV1','S1',2,'10-04-2024',100000,20000,80000),
	('HD2','KH1','NV1','S2',2,'10-04-2024',140000,0,140000),
	('HD3','KH2','NV3','S3',1,'10-04-2024',90000,0,90000),
	('HD4','KH3','NV3','S5',3,'10-04-2024',270000,20000,250000)
	

CREATE TABLE HOADONCT (
	MACTHD NVARCHAR(50)  NOT NULL,
    MAHD NVARCHAR(50) NOT NULL,
    MASACH NVARCHAR(50) NOT NULL,
    SOLUONG NVARCHAR(50) NOT NULL,
    GIAMUA INT NOT NULL,
	GIAMGIA INT NULL,
    THANHTIEN INT NOT NULL,
    PRIMARY KEY (MACTHD,MAHD),
    FOREIGN KEY(MASACH) REFERENCES SACH(MASACH),
    FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD)
);
delete from HOADONCT
insert into HOADONCT values
	('1','HD1','S1','2',50000,20000,80000),
	('2','HD2','S2','2',70000,0,140000),
	('3','HD3','S3','1',90000,0,90000),
	('4','HD4','S5','3',90000,20000,250000)



CREATE TABLE PHIEUNHAP (
    MAPN NVARCHAR(50) PRIMARY KEY,
    MANV NVARCHAR(50) NOT NULL,
	MASACH NVARCHAR(50) NOT NULL,
    MANCC NVARCHAR(50) NOT NULL,
	SOLUONG INT,
    NGAYNHAP DATETIME,
    TONGTIEN INT,
	FOREIGN KEY (MASACH) REFERENCES SACH(MASACH),
    FOREIGN KEY (MANV) REFERENCES NHANVIEN(IDNV),
    FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)
);
DELETE FROM PHIEUNHAP
INSERT INTO PHIEUNHAP VALUES
	('PN1','NV1','S1','NCC1',100,'04-10-2024',5000000),
	('PN2','NV1','S2','NCC1',100,'04-10-2024',7000000),
	('PN3','NV3','S3','NCC4',100,'04-10-2024',9000000),
	('PN4','NV2','S4','NCC5',100,'04-10-2024',10000000)


CREATE TABLE CTPHIEUNHAP (
    MACTPN NVARCHAR(50) NOT NULL,
    MAPN NVARCHAR(50) NOT NULL,
    MASACH NVARCHAR(50) NOT NULL,
    SOLUONG INT,
    DONGIA INT,
    THANHTIEN INT,
    FOREIGN KEY (MAPN) REFERENCES PHIEUNHAP(MAPN),
    FOREIGN KEY (MASACH) REFERENCES SACH(MASACH)
);

DELETE FROM CTPHIEUNHAP
INSERT INTO CTPHIEUNHAP VALUES
	('1','PN1','S1',100,50000,5000000),
	('2','PN2','S2',100,70000,7000000),
	('3','PN3','S3',100,90000,9000000),
	('4','PN4','S4',100,100000,10000000)

CREATE TABLE LICHSUGIA (
    MASACH NVARCHAR(50),
    NGAYCAPNHAT DATE NOT NULL,
    GIABAN INT,
    FOREIGN KEY(MASACH) REFERENCES SACH(MASACH),
    PRIMARY KEY (MASACH, NGAYCAPNHAT) -- Đặt cặp này làm PRIMARY KEY
);

CREATE TABLE VOUCHER (
    MAVOUCHER NVARCHAR(50) PRIMARY KEY,
    MAHD NVARCHAR(50) NOT NULL,
    TENVOUCHER NVARCHAR(50) NOT NULL,
    GIAMGIA INT,
    FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD)
);